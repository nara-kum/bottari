<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">

	<!-- 쇼핑몰상품리스트 -->
	<select id="selectList" resultType="com.example.vo.ProductVO">
	<![CDATA[
		select	product_no,
				category_no,
	            title,
	            price,
	            brand,
	            itemimg
		from product
		order by product_no desc
	]]>
	</select>

	<!-- 상품 등록 -->
	<insert id="insert" parameterType="com.example.vo.ProductVO">
    <![CDATA[
        insert into product (category_no, title, price, brand, itemimg, 
                           shipping_yn, shipping_cost, zipcode, address, detail_address)
        values (#{category_no}, #{title}, #{price}, #{brand}, #{itemimg},
                #{shipping_yn}, #{shipping_cost}, #{zipcode}, #{address}, #{detail_address})
    ]]>
    <selectKey keyProperty="product_no" resultType="int" order="AFTER">	
	     <![CDATA[
			select last_insert_id()
         ]]>        
	</selectKey>
	</insert>

	<!-- 상세이미지 등록 -->
	<insert id="detailImageInsert" parameterType="com.example.vo.DetailedImageVO">
		<![CDATA[
			insert into detail_image
			values(null, #{product_no}, #{image_URL}, #{turn})
		]]>
	</insert>

	<!-- 옵션 등록 -->
	<insert id="productOptionInsert" parameterType="com.example.vo.ProductOptionVO">
		<![CDATA[
			insert into product_option 
			values(null, #{product_no}, #{option_name})
		]]>
		<selectKey keyProperty="option_no" resultType="int" order="AFTER">	
	     <![CDATA[
			select last_insert_id()
         ]]>        
		</selectKey>
	</insert>

	<!-- 디테일 옵션 등록 -->
	<insert id="detailOptionInsert" parameterType="com.example.vo.ProductOptionVO">
		<![CDATA[
			insert into option_detail
			values(null, #{option_no}, #{detailOPtion_name})
		]]>
	</insert>


	<!-- 상품 상세 조회 -->
	<select id="selectOne" parameterType="int" resultType="com.example.vo.ProductViewVO">
	    <![CDATA[
			select 	p.product_no
				   ,p.category_no
		           ,p.title
		           ,p.price
		           ,p.brand
		           ,p.itemimg
		           ,p.shipping_yn
		           ,p.shipping_cost
		           ,p.zipcode
		           ,p.address
		           ,p.detail_address
			from product p
			where p.product_no = #{productNo}
	    ]]>
	</select>



	<!--상품 상세 이미지들 -->
	<select id="selectImageList" parameterType="int" resultType="com.example.vo.DetailedImageVO">
		<![CDATA[
			select 	detail_image_no detailedImage_no
				   ,product_no
				   ,image_URL
				   ,turn
			from detail_image
			where product_no = #{productNo}
			order by turn asc
		]]>
	</select>

	<!-- 옵션명 리스트 -->
	<select id="selectOptionList" parameterType="int" resultType="com.example.vo.ProductOptionVO">
		<![CDATA[
			select 	option_no,
					product_no,
			        option_name
			from product_option
			where product_no = #{productNo}
			order by option_no asc
		]]>
	</select>


	<!-- 옵션상세(아이템) 리스트 -->
	<select id="selectOptionDetailList" parameterType="int" resultType="com.example.vo.ProductOptionDetailVO">
		<![CDATA[
			select 	detailoption_no,
					option_no,
                	detailoption_name
    		from option_detail
    		where option_no = #{optionNo}
		]]>
	</select>
	
	
	
	
	<!-- 펀딩상세페이지 -->
	<select id = "selectOneFunding" parameterType="int" resultType="com.example.vo.FundingProductVO">
		<![CDATA[
			select 	 fp.funding_no
					,fp.user_no
		            ,fp.event_no
		            ,fp.wishlist_no
		            ,fp.product_no
		            ,fp.percent
		            ,fp.amount
		            ,fp.funding_status
		            ,fp.funding_date
			from funding_product fp
			where fp.funding_no = #{fundingNo}
		]]>	
	</select>
	
	
	

	<!-- 선택한 펀딩 옵션과 옵션제목들 -->
	<select id="selectListFundingOption" parameterType="int" resultType="com.example.vo.FundingOptionViewVO">
		<![CDATA[
			select 	fo.funding_no,
			        po.product_no,
					po.option_no,
					po.option_name,
					od.detailoption_no,
		            od.detailoption_name
			from funding_option fo, option_detail od, product_option po
			where fo.funding_no = #{fundingNo}
			and od.detailoption_no = fo.detailoption_no
			and od.option_no = po.option_no
		]]>
	</select>
	
	
	<!-- 펀딩별 현재 총결제액 -->
	<select id="selectTotalPayForFundingNo" parameterType="int" resultType="int">
		<![CDATA[
			select sum(p.payment_amount) totalpay
			from payment p
			where p.fundingproduct_no =  #{fundingNo}
		]]>
	</select>
	
	
	
	
	
	
	<!-- 장바구니 등록 -->

	<insert id="cartInsert" parameterType="com.example.vo.CartVO">
		<![CDATA[
			insert into cart (cart_no, user_no, product_no, category_no, Registration_date, quantity)
			values(null, #{user_no},#{product_no}, #{category_no},now(),#{quantity})
		]]>
		<selectKey keyProperty="cart_no" resultType="int" order="AFTER">	
        	<![CDATA[
            	select last_insert_id()
        	]]>        
    </selectKey>
	
	</insert>



	<!-- 장바구니 옵션 저장 -->
	<insert id="cartDetailOptionInsert" parameterType="com.example.vo.CartDetailOptionVO">
    <![CDATA[
        insert into cart_option (cart_no, detailoption_no) 
        values ( #{cart_no}, #{detailoption_no})
    ]]>
		<!-- auto_increment로 생성된 cartoption_no를 VO에 설정 -->
		<selectKey keyProperty="cartoption_no" resultType="int"
			order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>



	<!-- 위시리스트 등록 -->
	<insert id="wishlistInsert" parameterType="com.example.vo.WishlistVO">
	    <![CDATA[
	        insert into wishlist(wishlist_no, user_no, product_no, quantity, date)
	        values(null, #{userNo}, #{productNo}, #{quantity}, now())
	    ]]>
	<selectKey keyProperty="wishlistNo" resultType="int"
		order="AFTER">
		SELECT LAST_INSERT_ID()
	</selectKey>

	</insert>



	<!-- 위시리스트 옵션 저장 -->
	<insert id="wishlistOptionInsert" parameterType="com.example.vo.WishlistOptionVO">
    <![CDATA[
        insert into wishlist_option (wishlist_no, detailoption_no)
        values (#{wishlistNo}, #{detailoptionNo})
    ]]>
		<selectKey keyProperty="wishlistoptionNo" resultType="int"
			order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	

</mapper>