<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="checkout">
	
	<!-- 일반 구매일 때 -->
	<select id="selectList" resultType="com.example.vo.CheckOutVO">
		<![CDATA[
			select	c.cart_no,
					c.user_no,
			        c.product_no,
			        p.title,
			        p.price,
			        c.quantity,
			        p.brand,
			        p.shipping_cost,
			        p.itemimg,
			        po.option_name,
			        (p.price * c.quantity) AS item_total,
				    SUM(c.quantity) OVER(PARTITION BY c.user_no) AS total_quantity,
				    SUM(p.price * c.quantity) OVER(PARTITION BY c.user_no) AS total_amount
			from cart c
			left join product p on c.product_no = p.product_no
			left join product_option po on c.product_no = po.product_no
			where cart_no = #{cart_no}
		]]>
	</select>
	
	<!-- 펀딩 구매일 때 -->
	<select id="selectFundingList" resultType="com.example.vo.CheckoutFundingVO">
		<![CDATA[
			select	fp.funding_no,
					fp.product_no,
			        fp.percent,
			        fp.amount,
			        fp.funding_status,
			        p.title,
			        p.brand,
			        p.price
			from funding_product fp
			join product p on fp.product_no = p.product_no
			where fp.funding_no = #{funding_no}
		]]>
	</select>
</mapper>