<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="checkout">
	
	<!-- 일반 구매일 때 -->
	<select id="selectList" resultType="com.example.vo.CheckOutVO">
		<![CDATA[
			SELECT	c.cart_no,
					c.user_no,
			        c.product_no,
			        c.quantity,
			        co.detailoption_no,
			        p.title,
			        p.price,
			        p.brand,
			        p.itemimg,
			        p.shipping_cost,
			        po.option_no,
			        po.option_name,
			        (p.price * c.quantity) AS total_price,
			        SUM(c.quantity) OVER(PARTITION BY c.user_no) AS total_quantity,
			        SUM(c.quantity * p.price) OVER(PARTITION BY c.user_no) AS total_amount
			FROM cart c
			LEFT JOIN cart_option co ON c.cart_no = co.cart_no
			LEFT JOIN product p ON c.product_no = p.product_no
			LEFT JOIN product_option po ON c.product_no = po.product_no
			WHERE c.cart_no IN
		]]>
		<foreach collection="list" item="cartNos" open="(" close=")" separator=",">
			#{cartNos}
		</foreach>
	</select>
	
	<select id="selectDetail">
		<![CDATA[
			SELECT	co.detailoption_no,
			        od.detailoption_name
			FROM cart_option co
			LEFT JOIN option_detail od ON co.detailoption_no = od.detailoption_no
			WHERE cart_no IN
		]]>
		<foreach collection="list" item="cartNos" open="(" close=")" separator=",">
			#{cartNos}
		</foreach>
	</select>
	
	<!-- 펀딩 구매일 때 -->
	<select id="selectFundingList" resultType="com.example.vo.CheckoutFundingVO">
		<![CDATA[
			select	fp.funding_no,
					fp.product_no,
			        fp.percent,
			        fp.amount,
			        fp.funding_status,
			        p.title,
			        p.brand,
			        p.price
			from funding_product fp
			join product p on fp.product_no = p.product_no
			where fp.funding_no = #{funding_no}
		]]>
	</select>
</mapper>