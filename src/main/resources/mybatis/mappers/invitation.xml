<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="invitation">

	<!-- 초대장 리스트 가져오기 -->
	<select id="selectListByUser" parameterType="int" resultType="com.example.vo.InvitationVO">
		SELECT
			i.invitation_no             AS invitationNo,
			i.event_no                  AS eventNo,
			i.celebrate_date            AS celebrateDate,
			i.user_no            		AS userNo,
			COALESCE(i.photo_url,
			         '/assets/images/placeholder.png') AS photoUrl,
			c.event_name                AS eventName,
			CASE WHEN EXISTS (
			  SELECT 1
			    FROM funding_product fp
			   WHERE fp.user_no = i.user_no
			     AND fp.event_no = i.event_no
			) THEN 1 ELSE 0 END        AS hasFunding
		FROM invitation i
		LEFT JOIN calender c
		  ON c.event_no = i.event_no
		 AND c.user_no  = i.user_no
		WHERE i.user_no = #{userNo}
		ORDER BY i.invitation_no DESC
	</select>
	
	<!-- 초대장 등록 -->
	<insert id="insertInvitation" parameterType="com.example.vo.InvitationVO"
			useGeneratedKeys="true" keyProperty="invitationNo">
		<![CDATA[
			insert into invitation 
			values (null,#{categoryNo}
					,#{userNo}
					,#{eventNo}
					,#{themeNo}
					,#{photoUrl}
					,#{celebrateDate}
					,#{celebrateTime}
					,#{greeting}
					,#{place}
					,#{address1}
					,#{address2}
					,#{groomName}
					,#{groomContect}
					,#{groomFatherName}
					,#{groomFatherContect}
					,#{groomMotherName}
					,#{groomMotherContect}
					,#{brideName}
					,#{brideContect}
					,#{brideFatherName}
					,#{brideFatherContect}
					,#{brideMotherName}
					,#{brideMotherContect}
					,#{babyName}
					,#{babyFatherName}
					,#{babyFatherContect}
					,#{babyMotherName}
					,#{babyMotherContect}
					,now())
		]]>
	</insert>
	
</mapper>